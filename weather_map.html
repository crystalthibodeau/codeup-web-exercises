<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- Mapbox CSS -->
<!--    <link src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'>-->

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
</head>

<style>
    /*=============================================Direct Element Styles==============================================*/

    *{
        box-sizing: border-box;
    }
    body{
        /*background: url("img/clouds.png");*/
        background-size: cover;
        background-color: #D2E8F6;
        color: white;
        font-family: "Nunito Sans", sans-serif;

    }
    h1{
        font-size: 2.5em;
    }
    ::placeholder{
        text-align: center;
    }

    button {
        color: #494949 !important;
        background: #ffffff;
        border-radius: 6px;
        border: 1px solid #494949 !important;
        display: inline-block;
        transition: all 0.4s ease 0s;
    }
    button:hover {
        color: #ffffff !important;
        background: #1C3888;
        /*border-color: 0 !important;*/
        transition: all 0.4s ease 0s;
    }
    img{
        width: 100%;
        height:15em;
    }
    /*=============================================Grid Initialization================================================*/
    .parent {
        display: grid;
        /*grid-template-columns: repeat(auto-fit, minmax(5px, 1fr));*/
        grid-template-columns: 5% repeat(6, 15%) 5%;
        grid-template-rows: 8% 8% 10% 10% 10% 5% 3% 25% 14% 7%;
        grid-column-gap: 0px;
        grid-row-gap: 4px;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
    }

    .header {
        grid-area: 1 / 1 / 2 / 9;
        color: #848487;
        text-shadow: 1px 1px 0 #969696, 1px 8px 7px #aba8a8;
    }
    .header2 {
        grid-area: 2 / 1 / 3 / 9;}

    .weatherCards {
        grid-area: 3 / 2 / 6 / 8;
    }
    .innerDiv1{
        display: flex;
        justify-content: space-between;
        align-items: end;
        align-content: end;
    }

    .mapped {
        grid-area:  8 / 2 / 10 / 8;
        -webkit-box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
        box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);

    }

    .mapped-search{
        grid-area:  7 / 2 / 8 / 8;
        /*margin: 0 auto;*/
    }

    /*=================================================Card Flip=====================================================*/


    *, *:before, *:after {
        box-sizing: border-box;
    }

    @mixin mobile ($size: 640px) {
        @media screen and (max-width: $size) {
            @content;
        }
    }

    .f1_container {
        position: relative;
        /*margin: 10px auto;*/
        width: 30%;
        height:15em;
        z-index: 1;
    }
    .f1_container {
        perspective: 1000px;
    }
    .f1_card {
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: all 1.0s linear;
        /*border-radius: 5px;*/

    }
    .f1_container:hover .f1_card {
        transform: rotateY(180deg);
        -webkit-box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
        box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
        /*border-radius: 5px;*/

    }
    .face {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        transform-style: preserve-3d;
        transition: ease-in-out 600ms;
        /*border-radius: 5px;*/

    }
    .face.back {
        display: block;
        transform: rotateY(180deg);
        box-sizing: border-box;
        padding: 10px;
        color: #848487;
        text-align: center;
        background-color: white;
        /*border-radius: 5px;*/
        transform-style: preserve-3d;
        transition: ease-in-out 600ms;

    }
    #front1, #front2, #front3{
        text-align: center;
    }

    /*=================================================Text styles====================================================*/
    .textCenter{
        text-align: center;
    }
    .paddingNone{
        padding: 0;
    }
    .justTextShadow{
        text-shadow: 1px 1px 0 #969696, 1px 3px 6px #aba8a8;

    }
    /*=============================================More Styles================================================*/
    .headerBoxEffect{
        -webkit-box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
        box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
    }
    .background-not-blue{
        background: white ;
        color: #848487;
    }
    .shadow{
        -webkit-box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
        box-shadow: 0px 4px 30px 0px rgba(0,0,0,0.36);
    }
    .weatherCard{
        width: 30%;
    }
    .small{
        height: 20%;
        width: 20%;
        padding: 0;
        margin: 0;
    }
    #map {
        height: 100%;
    }
    .search-flex{
        display: flex;
        justify-content: flex-end;
        align-items: flex-end;
        align-content: flex-end;
        padding: 0;
        margin: 0;
        width: 100%;
    }
    .width{
        font-size:1.25em;
    }
    /*================================================End OF Styles===================================================*/

</style>
<body class="parent">



<div class="header ">
    <div>
    <h1 class="textCenter" id="weatherLocation">San Antonio Weather Forecast</h1>
    </div>
</div>
<div class="header2 justTextShadow" id="header2">

</div>
<div class="weatherCards">
    <div class="innerDiv1">



        <div class="f1_container">
            <div class="f1_card shadow">
                <div class="front face" id="front1">
                    <h1>hello</h1>
                </div>
                <div class="back face center" id="weatherDay1">
                    <p>This is nice for exposing more information about an image.</p>
                    <p>Any content can go here.</p>
                </div>
            </div>
        </div>

            <!--<div id="weatherDay1" class=" background-not-blue shadow weatherCard">-->
<!--        <div  class="card">-->
<!--            &lt;!&ndash;            <h2>HTML | Flip Card</h2>&ndash;&gt;-->
<!--            <div class="card-inner ">-->
<!--                <div class="card-front" id="weatherDay2">-->

<!--                    <div class="card-back">-->
<!--                        <p>A Computer Science Portal for Geeks</p>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

        <div class="f1_container">
            <div class="f1_card shadow">
                <div class="front face" id="front2">
                    <h1>hello</h1>
                </div>
                <div class="back face center" id="weatherDay2">
                    <p>This is nice for exposing more information about an image.</p>
                    <p>Any content can go here.</p>
                </div>
            </div>
        </div>




        <div class="f1_container">
            <div class="f1_card shadow">
                <div class="front face" id="front3">
                    <h1>hello</h1>
                </div>
                <div class="back face center" id="weatherDay3">
                    <p>This is nice for exposing more information about an image.</p>
                    <p>Any content can go here.</p>
                </div>
            </div>
        </div>

        <!--<div id="weatherDay2" class=" background-not-blue shadow weatherCard"></div>-->
<!--<div id="weatherDay3" class=" background-not-blue shadow weatherCard"></div>-->



    </div>
</div>


<!--</div>-->


<div class="mapped-search search-flex">
<input type="text" class="form-control mapped-search search-flex width" id="userSearch" placeholder="Find Weather By Address..">
<button id ="submit" type="button" class="width">Submit</button>
</div>

<div class="mapped">
    <div id='map'></div>
</div>

<!--/*===============================================Script Start==================================================*/-->


<script src="https://code.jquery.com/jquery-2.2.4.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>

<script>
    (function() {
        "use strict";
        $(document).ready(function() {

// <!--/*========================================Start Of Main Function============================================*/-->


            $.ajax("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/ac0657a1f6150fc148099fb06e9582aa/37.8267,-122.4233").done(function(data){

// <!--/*==================================Start Of Variable Initialization========================================*/-->
                var front1 = $('#front1');
                var front2 = $('#front2');
                var front3 = $('#front3');

                var weatherDay1 = $('#weatherDay1');
                var weatherDay2 = $('#weatherDay2');
                var weatherDay3 = $('#weatherDay3');
                var header2 = $('#header2');
                var imgSrc = "img/" + data.daily.data[0].icon + '.png';
                var imgSrcBackground = "img/background-" + data.daily.data[0].icon + '.png';


                var day1Date = new Date(data.currently.time * 1000); //digits missing off of time call to save memory the multiplication here fixes the time
                 var day2Date =  new Date((data.daily.data[1].time) * 1000);
                 var day3Date =  new Date((data.daily.data[2].time) * 1000);

                 var day1Split = day1Date.toString().split(' ');
                 var joined1 = day1Split[0] + " " + day1Split[1] + " " + day1Split[2];

                 var day2Split = day2Date.toString().split(' ');
                 var joined2 = day2Split[0] + " " + day2Split[1] + " " + day2Split[2];

                 var day3Split = day3Date.toString().split(' ');
                 var joined3 = day3Split[0] + " " + day3Split[1] + " " + day3Split[2];


                var day2TempLow =  (data.daily.data[1].temperatureLow);
                var day3TempLow =  (data.daily.data[2].temperatureLow);

                var day2TempHigh =  (data.daily.data[1].temperatureHigh);
                var day3TempHigh =  (data.daily.data[2].temperatureHigh);


// <!--/*=========================================Start Of Appending===============================================*/-->

                header2.html(
                        "<h3 class='textCenter'>" + data.daily.summary + "</h3>"
                );
                console.log(data.daily.summary);
                front1.css({
                    'background': "url('img/clouds.gif')"
                    }
                );
                weatherDay1.html("<div class='textCenter'>" +

                        '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                        "<h3 class='paddingNone'>" +  "Today: " + joined1 + "</h3>" +
                         "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                         "<p class='paddingNone'>" + "Current Temperature of " + parseInt(data.currently.temperature) + "°" + "</p>" +
                         "<h2 class='paddingNone'>" + parseInt(data.daily.data[1].temperatureHigh) + "°/" +parseInt(data.daily.data[1].temperatureLow) + "°" + "</h2>"

                    + "</div>");
                weatherDay1.css({
                    'background': imgSrcBackground,
                });

                front2.css({
                        'background': "url('img/ooolala.jpg')"
                    }
                );

                 weatherDay2.html("<div class='textCenter'>" +

                     '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                     "<h3 class='paddingNone'>" + joined2 + "</h3>" +
                     "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                     "<h2 class='paddingNone'>" + parseInt(day2TempHigh) + "°/" +parseInt(day2TempLow) + "°" + "</h2>"

                     + "</div>");

                front3.css({
                        'background': "url('img/night-bend.jpg')",
                        'background-size': 'cover'
                    }
                );

                 weatherDay3.html("<div class='textCenter'>" +

                     '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                     "<h3 class='paddingNone'>" + joined3 + "</h3>" +
                     "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                     "<h2 class='paddingNone'>" + parseInt(day3TempHigh) + "°/" +parseInt(day3TempLow) + "°" + "</h2>"

                     + "</div>");
                 console.log(data);
            });




// <!--/*===========================================Button Search==================================================*/-->


                //     north east positive
    // south west negative


            $('#submit').click(function () {
                var search = $(userSearch).val();

                //Use geocode function to get coordinates based on a physical address then store
                geocode(search, mapboxToken).then(function (result) {
                    var long = result[0].toString();
                    var lat = result[1].toString();
                    $.ajax("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/" + lat + ", " + long)
                        .done(function (data) {

                            console.log(data);

                            var weatherDay1 = $('#weatherDay1');
                            var weatherDay2 = $('#weatherDay2');
                            var weatherDay3 = $('#weatherDay3');
                            var header2 = $('#header2');
                            var imgSrc = "img/" + data.daily.data[0].icon + '.png';


                            var day1Date = new Date(data.currently.time * 1000); //digits missing off of time call to save memory the multiplication here fixes the time
                            var day2Date =  new Date((data.daily.data[1].time) * 1000);
                            var day3Date =  new Date((data.daily.data[2].time) * 1000);

                            var day1Split = day1Date.toString().split(' ');
                            var joined1 = day1Split[0] + " " + day1Split[1] + " " + day1Split[2];

                            var day2Split = day2Date.toString().split(' ');
                            var joined2 = day2Split[0] + " " + day2Split[1] + " " + day2Split[2];

                            var day3Split = day3Date.toString().split(' ');
                            var joined3 = day3Split[0] + " " + day3Split[1] + " " + day3Split[2];


                            var day2TempLow =  (data.daily.data[1].temperatureLow);
                            var day3TempLow =  (data.daily.data[2].temperatureLow);

                            var day2TempHigh =  (data.daily.data[1].temperatureHigh);
                            var day3TempHigh =  (data.daily.data[2].temperatureHigh);

                            header2.html(
                                "<h3 class='textCenter'>" + data.daily.summary + "</h3>"
                            );

                            weatherDay1.html("<div class='textCenter'>" +

                                '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                                "<h3 class='paddingNone'>" +  "Today: " + joined1 + "</h3>" +
                                "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                                "<p class='paddingNone'>" + "Current Temperature of " + parseInt(data.currently.temperature) + "°" + "</p>" +
                                "<h2 class='paddingNone'>" + parseInt(data.daily.data[0].temperatureHigh) + "°/" +parseInt(data.daily.data[0].temperatureLow) + "°" + "</h2>"

                                + "</div>");

                            weatherDay2.html("<div class='textCenter'>" +

                                '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                                "<h3 class='paddingNone'>" + joined2 + "</h3>" +
                                "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                                "<p class='paddingNone'>" + "High Temperature of " + parseInt(day2TempHigh) + "°" + "</p>" +
                                "<h2 class='paddingNone'>" + "Low Temperature of " + parseInt(day2TempLow) + "°" + "</h2>"
                                + "</div>");


                            weatherDay3.html("<div class='textCenter'>" +

                                '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                                "<h3 class='paddingNone'>" + joined3 + "</h3>" +
                                "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                                "<h2 class='paddingNone'>" + parseInt(day3TempHigh) + "°/" +parseInt(day3TempLow) + "°" + "</h2>"

                                + "</div>");
                            console.log(data);

                            map.flyTo({center:result,zoom:10});

                            // $("#weatherLocation").html(search.toUpperCase() + ' FORECAST');
                            // marker.setLngLat([long, lat]);

                            // geocode(search, mapboxToken);

                            var mapCity = geocode(search, mapboxToken);
                            mapCity.then(function(result) {
                                console.log(result);
                                var resultLong = result[0] ;
                                var resultLat = result[1] ;
                                var coordinates = {
                                    "lng": resultLong,
                                    "lat": resultLat,

                                };
                                marker.setLngLat([coordinates.lng, coordinates.lat]);

                                reverseGeocode(coordinates, mapboxToken).then(function(data) {
                                    var resultSplit = data.toString().split(', ');
                                    var resultJoin = resultSplit[resultSplit.length-3] + " " + resultSplit[resultSplit.length-2];
                                    $('#weatherLocation').html(resultJoin + " " + 'Weather Forecast');
                                    console.log(data);

                                    console.log(resultSplit);
                                });
                            });

                        });
                })
            });
// <!--/*============================================Start Of Map==================================================*/-->

            mapboxgl.accessToken = mapboxToken;

            var mapOptions = {
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v10',
                zoom: 7,
                pitch: 65,
                center: [-98.4916, 29.4252],
                sprite: "mapbox://sprites/mapbox/bright-v8"
                // interactive: false
            };
            var map = new mapboxgl.Map(mapOptions);
            var markerOptions = {
                color: "#1C3888",
                draggable: true
            };
            var marker = new mapboxgl.Marker(markerOptions)
                .setLngLat([-98.4816, 29.4260])
                .addTo(map);
            console.log(marker._lngLat.lng);
            console.log(marker._lngLat.lat);


            function onDragEnd() {
                var lngLat = marker.getLngLat();
                var weather = 'https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/' + darkSkyKey + "/" + lngLat.lat + "," + lngLat.lng;
                // // Pulling Weather
                $.get(weather).done(function (data) {
                    console.log(data);
                    var weatherDay1 = $('#weatherDay1');
                    var weatherDay2 = $('#weatherDay2');
                    var weatherDay3 = $('#weatherDay3');
                    var header2 = $('#header2');
                    var imgSrc = "img/" + data.daily.data[0].icon + '.png';


                    var day1Date = new Date(data.currently.time * 1000); //digits missing off of time call to save memory the multiplication here fixes the time
                    var day2Date =  new Date((data.daily.data[1].time) * 1000);
                    var day3Date =  new Date((data.daily.data[2].time) * 1000);

                    var day1Split = day1Date.toString().split(' ');
                    var joined1 = day1Split[0] + " " + day1Split[1] + " " + day1Split[2];

                    var day2Split = day2Date.toString().split(' ');
                    var joined2 = day2Split[0] + " " + day2Split[1] + " " + day2Split[2];

                    var day3Split = day3Date.toString().split(' ');
                    var joined3 = day3Split[0] + " " + day3Split[1] + " " + day3Split[2];


                    var day2TempLow =  (data.daily.data[1].temperatureLow);
                    var day3TempLow =  (data.daily.data[2].temperatureLow);

                    var day2TempHigh =  (data.daily.data[1].temperatureHigh);
                    var day3TempHigh =  (data.daily.data[2].temperatureHigh);

                    header2.html(
                        "<h3 class='textCenter'>" + data.daily.summary + "</h3>"
                    );

                    weatherDay1.html("<div class='textCenter'>" +

                        '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                        "<h3 class='paddingNone'>" +  "Today: " + joined1 + "</h3>" +
                        "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                        "<p class='paddingNone'>" + "Current Temperature of " + parseInt(data.currently.temperature) + "°" + "</p>" +
                        "<h2 class='paddingNone'>" + "High of " + parseInt(data.daily.data[0].temperatureHigh) + "°" + "Low Temperature of " + parseInt(data.daily.data[0].temperatureLow) + "°" + "</h2>"

                        + "</div>");

                    weatherDay2.html("<div class='textCenter'>" +

                        '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                        "<h3 class='paddingNone'>" + joined2 + "</h3>" +
                        "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                        "<p class='paddingNone'>" + "High Temperature of " + parseInt(day2TempHigh) + "°" + "</p>" +
                        "<h2 class='paddingNone'>" + "Low Temperature of " + parseInt(day2TempLow) + "°" + "</h2>"
                        + "</div>");


                    weatherDay3.html("<div class='textCenter'>" +

                        '<img src="'+ imgSrc + '" alt="" class ="small"/>' +
                        "<h3 class='paddingNone'>" + joined3 + "</h3>" +
                        "<p class='paddingNone'>" + data.hourly.summary + "</p>" +
                        "<h2 class='paddingNone'>" + parseInt(day3TempHigh) + "°/" +parseInt(day3TempLow) + "°" + "</h2>"

                        + "</div>");
                    // console.log(data);
                    var mapCity = reverseGeocode(lngLat, mapboxToken);
                    console.log(Promise.resolve(mapCity));

                    mapCity.then(function(result) {
                        console.log(lngLat);
                        var resultSplit = result.toString().split(', ');
                        var resultJoin = resultSplit[resultSplit.length-3] + " " + resultSplit[resultSplit.length-2];
                        $('#weatherLocation').html(resultJoin + " " + 'Weather Forecast');
                        console.log(result);

                        console.log(resultSplit);
                    });



                });
            }

            marker.on('dragend', onDragEnd);
// <!--/*=======================================End of Document Ready==============================================*/-->

        });
    })();
</script>
</body>
</html>